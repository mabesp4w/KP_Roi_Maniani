import{r as s,j as e,c as A,z as l,a as m,u as G,H as U}from"./app-DT32C7nY.js";import{M as X,S as J,T as Q,A as W,C as Y}from"./Table-CL22LIrt.js";import{F as Z}from"./FormCurrencyInput-Y-IASF2j.js";import{u as ee,F as ae,a as te,o as se,c as re,d as ne,b as N}from"./index.esm-Ci-6NNXr.js";import{F as ie,S as oe}from"./FormSelect-dtlN2kn6.js";import{B as _}from"./Button-DkoYT9R8.js";import{B as le}from"./Badge-ayPLFCxx.js";import{C as T,a as M,c as ce,b as de}from"./Card-DvLVLLze.js";import{P as me}from"./Pagination-DsMwMylt.js";import{A as ue}from"./AdminLayout-qkJBv-y2.js";import{X as he}from"./x-CHumAv0e.js";import{P as pe}from"./plus-K_uxNSFF.js";import"./createLucideIcon-CMnZVN2_.js";import"./trash-2-BHSVLgJt.js";import"./chevron-right-bjn_y0tR.js";import"./users-D15wB9T6.js";import"./user-DeY8Ogeh.js";const fe=re({kecamatan_id:N().required("Kecamatan wajib dipilih"),nama_desa:N().required("Nama desa/kelurahan wajib diisi"),ongkir:ne().typeError("Ongkir harus berupa angka").required("Ongkir wajib diisi").min(0,"Ongkir tidak boleh negatif")});function P({isOpen:i,onClose:g,ongkir:r=null,onSuccess:c}){const u=!!r,[h,S]=s.useState([]),[v,C]=s.useState(!1),[d,x]=s.useState(!1),b=ee({resolver:se(fe),defaultValues:{kecamatan_id:"",nama_desa:"",ongkir:""}}),{handleSubmit:y,reset:n,setValue:K}=b;s.useEffect(()=>{i&&(async()=>{C(!0);try{const f=await A.get(route("admin.kecamatan.list"));S(f.data)}catch(f){console.error("Error fetching kecamatan:",f),l.error("Gagal memuat daftar kecamatan")}finally{C(!1)}})()},[i]),s.useEffect(()=>{n(r?{kecamatan_id:r.kecamatan_id||"",nama_desa:r.nama_desa||"",ongkir:r.ongkir||""}:{kecamatan_id:"",nama_desa:"",ongkir:""})},[r,n]);const p=o=>{x(!0);const f=u?`/admin/ongkir/${r.id}`:"/admin/ongkir";m[u?"put":"post"](f,o,{onSuccess:()=>{j(),c&&c()},onError:k=>{console.error("Submit error:",k),k.message?l.error(k.message):Object.values(k).length>0?l.error(Object.values(k)[0]):l.error(`Terjadi kesalahan saat ${u?"mengubah":"menambah"} ongkir`)},onFinish:()=>{x(!1)}})},j=()=>{n(),g()},D=h.map(o=>({value:o.id,label:o.nama_kecamatan}));return e.jsx(X,{id:"modal-ongkir",isOpen:i,onClose:j,size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:u?"Edit Ongkir":"Tambah Ongkir"}),e.jsx(ae,{...b,children:e.jsxs("form",{onSubmit:y(p),className:"space-y-4",children:[e.jsx(ie,{name:"kecamatan_id",label:"Kecamatan",options:D,placeholder:"Pilih Kecamatan",isDisabled:d||v,isSearchable:!0,isClearable:!1,required:!0}),e.jsx(te,{name:"nama_desa",label:"Nama Desa/Kelurahan",placeholder:"Contoh: Desa Example",disabled:d,required:!0}),e.jsx(Z,{name:"ongkir",label:"Ongkir",placeholder:"0",disabled:d,required:!0}),e.jsxs("div",{className:"modal-action",children:[e.jsx(_,{variant:"outline",type:"button",onClick:j,disabled:d,children:"Batal"}),e.jsx(_,{variant:"primary",type:"submit",disabled:d||v,children:d?"Menyimpan...":u?"Simpan Perubahan":"Simpan"})]})]})})]})})}function Te({ongkir:i,filters:g}){const{props:r}=G();r.auth;const[c,u]=s.useState(g.search||""),[h,S]=s.useState(g.kecamatan_id||""),[v,C]=s.useState([]),[d,x]=s.useState(!1),[b,y]=s.useState(null),[n,K]=s.useState(g.sort||"nama_desa"),[p,j]=s.useState(g.direction||"asc"),[D,o]=s.useState(!1),[f,O]=s.useState(!1),[k,w]=s.useState(null);s.useEffect(()=>{(async()=>{try{const t=await A.get(route("admin.kecamatan.list"));C(t.data)}catch(t){console.error("Error fetching kecamatan:",t)}})()},[]),s.useEffect(()=>{r.success&&l.success(r.success),r.error&&l.error(r.error)},[r.success,r.error]);const B=a=>{a.preventDefault(),m.get(route("admin.ongkir.index"),{search:c,kecamatan_id:h,sort:n,direction:p},{preserveState:!0,preserveScroll:!0})},I=a=>{const t=a?a.value:"";S(t),m.get(route("admin.ongkir.index"),{search:c,kecamatan_id:t,sort:n,direction:p},{preserveState:!0,preserveScroll:!0})},$=()=>{S(""),m.get(route("admin.ongkir.index"),{search:c,sort:n,direction:p},{preserveState:!0,preserveScroll:!0})},q=a=>{const t=n===a&&p==="asc"?"desc":"asc";K(a),j(t),m.get(route("admin.ongkir.index"),{search:c,kecamatan_id:h,sort:a,direction:t},{preserveState:!0,preserveScroll:!0})},L=a=>{y(a),x(!0)},z=()=>{if(b){const a=`/admin/ongkir/${b.id}`;m.delete(a,{preserveScroll:!0,onSuccess:t=>{x(!1),y(null)},onError:t=>{console.error("Delete error:",t),t.message?l.error(t.message):Object.values(t).length>0?l.error(Object.values(t)[0]):l.error("Terjadi kesalahan saat menghapus ongkir")}})}},H=a=>{w(a),O(!0)},F=()=>{O(!1),w(null)},R=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),E=[{value:"",label:"Semua Kecamatan"},...v.map(a=>({value:a.id,label:a.nama_kecamatan}))],V=h?E.find(a=>a.value===h):E[0];return e.jsxs(ue,{auth:r.auth,header:"Data Ongkir",children:[e.jsx(U,{title:"Data Ongkir"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(T,{children:e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsx(J,{value:c,onChange:u,onSubmit:B,placeholder:"Cari ongkir...",className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-full md:w-64",children:e.jsx(oe,{options:E,value:V,onChange:I,placeholder:"Filter Kecamatan",isSearchable:!0,isClearable:!1})}),h&&e.jsxs(_,{variant:"outline",onClick:$,className:"gap-2",children:[e.jsx(he,{size:16}),"Clear"]})]}),e.jsxs(_,{variant:"primary",className:"gap-2",onClick:()=>o(!0),children:[e.jsx(pe,{size:18}),"Tambah Ongkir"]})]})})}),e.jsxs(T,{children:[e.jsx(ce,{children:e.jsxs(de,{children:["Daftar Ongkir (",i.total,")"]})}),e.jsx(M,{className:"p-0",children:e.jsx(Q,{headers:[{label:"No",key:"no",sortable:!1},{label:"Kecamatan",key:"kecamatan",sortable:!1},{label:"Desa/Kelurahan",key:"nama_desa",sortable:!0},{label:"Ongkir",key:"ongkir",sortable:!0},{label:"Aksi",key:"aksi",sortable:!1}],data:i.data,renderRow:(a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:(i.current_page-1)*i.per_page+t+1}),e.jsx("td",{children:a.kecamatan?.nama_kecamatan||"-"}),e.jsx("td",{children:a.nama_desa}),e.jsx("td",{children:e.jsx(le,{variant:"success",children:R(a.ongkir)})}),e.jsx("td",{children:e.jsx(W,{onEdit:()=>H(a),onDelete:()=>L(a)})})]},a.id),emptyMessage:"Tidak ada data ongkir",emptyColSpan:5,sortConfig:{key:n,direction:p},onSort:q})})]}),e.jsx(me,{links:i.links})]}),e.jsx(P,{isOpen:D,onClose:()=>o(!1),onSuccess:()=>{o(!1),m.reload()}}),e.jsx(P,{isOpen:f,onClose:F,ongkir:k,onSuccess:()=>{F(),m.reload()}}),e.jsx(Y,{isOpen:d,onClose:()=>x(!1),onConfirm:z,title:"Hapus Ongkir",message:`Apakah Anda yakin ingin menghapus ongkir untuk "${b?.nama_desa}"?`})]})}export{Te as default};
