import{r as t,j as e,c as B,z as d,a as m,u as G,H as J}from"./app-DiO4YTWd.js";import{M as U,S as X,T as Q,A as W,C as Y}from"./Table-DVP2rC95.js";import{u as Z,F as ee,a as ae,o as te,c as re,b as w}from"./index.esm-jL87IQ5v.js";import{F as se,S as oe}from"./FormSelect-z4YfK3qo.js";import{B as _}from"./Button-BsG5zIYg.js";import{B as T}from"./Badge-Ciu0XMlR.js";import{C as F,a as M,b as ie,c as le}from"./Card-BGz1axvI.js";import{P as ne}from"./Pagination-qYbOjDif.js";import{A as de}from"./AdminLayout-BSmZjGOe.js";import{X as ce}from"./x-CCMz-52p.js";import{P as ue}from"./plus-zM8o0Y-5.js";import"./eye-Be8_HVQe.js";import"./createLucideIcon-BZC9d3V6.js";import"./trash-2-Z6dWABqx.js";import"./chevron-right-DbzAQtlb.js";import"./users-BTyOlAby.js";import"./user-DA0weDVr.js";const me=re({kategori_id:w().required("Kategori wajib dipilih"),nama_produk:w().required("Nama produk wajib diisi")});function A({isOpen:i,onClose:k,produk:r=null,onSuccess:c}){const h=!!r,[p,S]=t.useState([]),[b,v]=t.useState(!1),[g,x]=t.useState(!1),j=Z({resolver:te(me),defaultValues:{kategori_id:"",nama_produk:""}}),{handleSubmit:C,reset:o}=j;t.useEffect(()=>{i&&(async()=>{v(!0);try{const n=await B.get(route("admin.kategori.list"));S(n.data)}catch(n){console.error("Error fetching kategori:",n),d.error("Gagal memuat daftar kategori")}finally{v(!1)}})()},[i]),t.useEffect(()=>{o(r?{kategori_id:r.kategori_id||"",nama_produk:r.nama_produk||""}:{kategori_id:"",nama_produk:""})},[r,o]);const y=f=>{x(!0);const n=h?`/admin/produk/${r.id}`:"/admin/produk";m[h?"put":"post"](n,f,{onSuccess:()=>{l(),c&&c()},onError:u=>{console.error("Submit error:",u),u.message?d.error(u.message):Object.values(u).length>0?d.error(Object.values(u)[0]):d.error(`Terjadi kesalahan saat ${h?"mengubah":"menambah"} produk`)},onFinish:()=>{x(!1)}})},l=()=>{o(),k()},P=p.map(f=>({value:f.id,label:f.nama_kategori}));return e.jsx(U,{id:"modal-produk",isOpen:i,onClose:l,size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:h?"Edit Produk":"Tambah Produk"}),e.jsx(ee,{...j,children:e.jsxs("form",{onSubmit:C(y),className:"space-y-4",children:[e.jsx(se,{name:"kategori_id",label:"Kategori",options:P,placeholder:"Pilih Kategori",isDisabled:g||b,isSearchable:!0,isClearable:!1,required:!0}),e.jsx(ae,{name:"nama_produk",label:"Nama Produk",placeholder:"Contoh: Kue Ulang Tahun Coklat",disabled:g,required:!0}),e.jsxs("div",{className:"modal-action",children:[e.jsx(_,{variant:"outline",type:"button",onClick:l,disabled:g,children:"Batal"}),e.jsx(_,{variant:"primary",type:"submit",disabled:g||b,children:g?"Menyimpan...":h?"Simpan Perubahan":"Simpan"})]})]})})]})})}function Ne({produk:i,filters:k}){const{props:r}=G(),[c,h]=t.useState(k.search||""),[p,S]=t.useState(k.kategori_id||""),[b,v]=t.useState([]),[g,x]=t.useState(!1),[j,C]=t.useState(null),[o,y]=t.useState(k.sort||"nama_produk"),[l,P]=t.useState(k.direction||"asc"),[f,n]=t.useState(!1),[D,u]=t.useState(!1),[O,K]=t.useState(null);t.useEffect(()=>{(async()=>{try{const s=await B.get(route("admin.kategori.list"));v(s.data)}catch(s){console.error("Error fetching kategori:",s)}})()},[]),t.useEffect(()=>{r.success&&d.success(r.success),r.error&&d.error(r.error)},[r.success,r.error]);const L=a=>{a.preventDefault(),m.get(route("admin.produk.index"),{search:c,kategori_id:p,sort:o,direction:l},{preserveState:!0,preserveScroll:!0})},$=a=>{const s=a?a.value:"";S(s),m.get(route("admin.produk.index"),{search:c,kategori_id:s,sort:o,direction:l},{preserveState:!0,preserveScroll:!0})},z=()=>{S(""),m.get(route("admin.produk.index"),{search:c,sort:o,direction:l},{preserveState:!0,preserveScroll:!0})},q=a=>{const s=o===a&&l==="asc"?"desc":"asc";y(a),P(s),m.get(route("admin.produk.index"),{search:c,kategori_id:p,sort:a,direction:s},{preserveState:!0,preserveScroll:!0})},H=a=>{C(a),x(!0)},I=()=>{j&&m.delete(`/admin/produk/${j.id}`,{preserveScroll:!0,onSuccess:()=>{x(!1),C(null)},onError:a=>{console.error("Delete error:",a),a.message?d.error(a.message):Object.values(a).length>0?d.error(Object.values(a)[0]):d.error("Terjadi kesalahan saat menghapus produk")}})},R=a=>{K(a),u(!0)},N=()=>{u(!1),K(null)},E=[{value:"",label:"Semua Kategori"},...b.map(a=>({value:a.id,label:a.nama_kategori}))],V=p?E.find(a=>a.value===p):E[0];return e.jsxs(de,{auth:r.auth,header:"Data Produk",children:[e.jsx(J,{title:"Data Produk"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{children:e.jsx(M,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsx(X,{value:c,onChange:h,onSubmit:L,placeholder:"Cari produk...",className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-full md:w-64",children:e.jsx(oe,{options:E,value:V,onChange:$,placeholder:"Filter Kategori",isSearchable:!0,isClearable:!1})}),p&&e.jsxs(_,{variant:"outline",onClick:z,className:"gap-2",children:[e.jsx(ce,{size:16}),"Clear"]})]}),e.jsxs(_,{variant:"primary",className:"gap-2",onClick:()=>n(!0),children:[e.jsx(ue,{size:18}),"Tambah Produk"]})]})})}),e.jsxs(F,{children:[e.jsx(ie,{children:e.jsxs(le,{children:["Daftar Produk (",i.total,")"]})}),e.jsx(M,{className:"p-0",children:e.jsx(Q,{headers:[{label:"No",key:"no",sortable:!1},{label:"Nama Produk",key:"nama_produk",sortable:!0},{label:"Kategori",key:"kategori",sortable:!1},{label:"Jumlah Varian",key:"varian",sortable:!1},{label:"Aksi",key:"aksi",sortable:!1}],data:i.data,renderRow:(a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:(i.current_page-1)*i.per_page+s+1}),e.jsx("td",{children:a.nama_produk}),e.jsx("td",{children:e.jsx(T,{variant:"primary",children:a.kategori?.nama_kategori||"-"})}),e.jsx("td",{children:e.jsxs(T,{variant:"info",children:[a.varian_produks_count||0," varian"]})}),e.jsx("td",{children:e.jsx(W,{onEdit:()=>R(a),onDelete:()=>H(a)})})]},a.id),emptyMessage:"Tidak ada data produk",emptyColSpan:5,sortConfig:{key:o,direction:l},onSort:q})})]}),e.jsx(ne,{links:i.links})]}),e.jsx(A,{isOpen:f,onClose:()=>n(!1),onSuccess:()=>{n(!1),m.reload()}}),e.jsx(A,{isOpen:D,onClose:N,produk:O,onSuccess:()=>{N(),m.reload()}}),e.jsx(Y,{isOpen:g,onClose:()=>x(!1),onConfirm:I,title:"Hapus Produk",message:`Apakah Anda yakin ingin menghapus produk "${j?.nama_produk}"?`})]})}export{Ne as default};
