import{r as o,z as t,j as e,H as S,L as d,a as P}from"./app-DT32C7nY.js";import{U as C,S as D}from"./UserLayout-RTAU9vEL.js";import{B as r}from"./Button-DkoYT9R8.js";import{A as _}from"./arrow-left-C9i6VctD.js";import{C as b}from"./clock-CwXyIdsK.js";import{C as N}from"./credit-card-Ai9vwC_Q.js";import{P as y,M as I}from"./x-CHumAv0e.js";import{T as h}from"./truck-CQ-pxHod.js";import{C as g}from"./circle-check-big-B2vXspBZ.js";import{S as M}from"./shopping-bag-CK2gU9WT.js";import{C as B}from"./circle-alert-DWMPioR-.js";import"./cake-CAqAkV2S.js";import"./createLucideIcon-CMnZVN2_.js";import"./user-DeY8Ogeh.js";import"./phone-D3b-d1Th.js";import"./mail--kKUj2iP.js";function X({order:s,items:w,midtransClientKey:m}){const[l,c]=o.useState(!1),[L,u]=o.useState(!1),[x,f]=o.useState(!1),i=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),p=(a=>{const n={pending:{label:"Menunggu Pembayaran",color:"badge-warning",icon:b},processing:{label:"Diproses",color:"badge-info",icon:y},shipped:{label:"Dikirim",color:"badge-primary",icon:h},delivered:{label:"Selesai",color:"badge-success",icon:g},cancelled:{label:"Dibatalkan",color:"badge-error",icon:B}};return n[a]||n.pending})(s.status),v=p.icon;o.useEffect(()=>{if(s.snap_token&&s.status==="pending"&&m){if(document.querySelector('script[src*="midtrans"]')){u(!0);return}const n=document.createElement("script");return n.src="https://app.sandbox.midtrans.com/snap/snap.js",n.setAttribute("data-client-key",m),n.async=!0,n.onload=()=>{u(!0)},n.onerror=()=>{console.error("Failed to load Midtrans Snap script"),t.error("Gagal memuat sistem pembayaran")},document.head.appendChild(n),()=>{}}},[s.snap_token,m,s.status]);const j=()=>{if(!s.snap_token){t.error("Token pembayaran tidak tersedia");return}if(!window.snap){t.error("Sistem pembayaran belum siap, silakan refresh halaman");return}c(!0),window.snap.pay(s.snap_token,{onSuccess:function(a){console.log("Payment success:",a),t.success("Pembayaran berhasil!"),window.location.reload()},onPending:function(a){console.log("Payment pending:",a),t.info("Menunggu pembayaran..."),c(!1)},onError:function(a){console.log("Payment error:",a),t.error("Pembayaran gagal"),c(!1)},onClose:function(){console.log("Payment popup closed"),c(!1)}})},k=()=>{f(!0),P.post(route("pesanan.confirm",s.id),{},{preserveScroll:!0,onSuccess:()=>{t.success("Pesanan berhasil dikonfirmasi!")},onError:()=>{t.error("Gagal mengonfirmasi pesanan")},onFinish:()=>{f(!1)}})};return e.jsxs(C,{children:[e.jsx(S,{title:"Detail Pesanan - Angel Cake'S"}),e.jsx("section",{className:"pt-28 pb-12 px-4 min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(d,{href:"/pesanan",className:"btn btn-ghost btn-circle",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Detail Pesanan"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: ",s.id.slice(0,8).toUpperCase()]})]})]}),s.status==="pending"?e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl p-6 text-white mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Menunggu Pembayaran"}),e.jsx("p",{className:"opacity-90",children:"Silakan selesaikan pembayaran Anda"})]}),s.snap_token&&e.jsxs(r,{variant:"secondary",onClick:j,disabled:l,loading:l,className:"bg-white text-orange-600 hover:bg-gray-100",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),l?"Memproses...":"Bayar Sekarang"]})]})}):s.status==="processing"?e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl p-6 text-white mb-8",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(y,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pembayaran Berhasil!"}),e.jsx("p",{className:"opacity-90",children:"Pesanan sedang diproses"})]})]})}):s.status==="shipped"?e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-6 text-white mb-8",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(h,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pesanan Sedang Dikirim!"}),e.jsx("p",{className:"opacity-90",children:"Konfirmasi jika pesanan sudah diterima"})]}),e.jsxs(r,{variant:"secondary",onClick:k,disabled:x,loading:x,className:"bg-white text-purple-600 hover:bg-gray-100",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),x?"Memproses...":"Konfirmasi Diterima"]})]})}):s.status==="delivered"?e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl p-6 text-white mb-8",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(g,{className:"w-8 h-8"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pesanan Selesai!"}),e.jsx("p",{className:"opacity-90",children:s.created_at})]}),e.jsx(d,{href:route("ulasan.create",s.id),children:e.jsxs(r,{variant:"secondary",className:"bg-white text-green-600 hover:bg-gray-100",children:[e.jsx(D,{className:"w-5 h-5 mr-2"}),"Beri Ulasan"]})})]})}):null,e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Status Pesanan"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.status==="delivered"?"bg-green-100":s.status==="cancelled"?"bg-red-100":s.status==="processing"?"bg-blue-100":"bg-yellow-100"}`,children:e.jsx(v,{className:`w-6 h-6 ${s.status==="delivered"?"text-green-600":s.status==="cancelled"?"text-red-600":s.status==="processing"?"text-blue-600":"text-yellow-600"}`})}),e.jsxs("div",{children:[e.jsx("span",{className:`badge ${p.color}`,children:p.label}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Dibuat: ",s.created_at]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-pink-500"}),"Daftar Pesanan"]}),e.jsx("div",{className:"divide-y",children:w.map(a=>e.jsxs("div",{className:"flex gap-4 py-4 first:pt-0 last:pb-0",children:[e.jsx("img",{src:a.image,alt:a.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold line-clamp-2",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[i(a.price)," x ",a.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-bold text-pink-500",children:i(a.subtotal)})})]},a.id))})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-pink-500"}),"Alamat Pengiriman"]}),e.jsx("p",{className:"text-gray-700 whitespace-pre-line",children:s.alamat}),s.kecamatan&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-sm text-gray-500",children:[e.jsx(h,{className:"w-4 h-4"}),e.jsxs("span",{children:["Pengiriman ke ",s.kecamatan]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 sticky top-28",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Ringkasan Pembayaran"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsx("span",{children:i(s.total_harga)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),e.jsx("span",{children:i(s.ongkir)})]}),e.jsx("div",{className:"divider my-2"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-pink-500",children:i(s.total_pembayaran)})]})]}),s.status==="pending"&&s.snap_token&&e.jsxs(r,{variant:"primary",className:"w-full mt-6",onClick:j,disabled:l,loading:l,children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),l?"Memproses...":"Bayar Sekarang"]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsx(d,{href:"/pesanan",className:"btn btn-outline w-full",children:"Lihat Semua Pesanan"}),e.jsx(d,{href:"/produk",children:e.jsx(r,{variant:"ghost",className:"w-full",children:"Belanja Lagi"})})]})]})})]})]})})]})}export{X as default};
