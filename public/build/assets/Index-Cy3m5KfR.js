import{r as l,j as e,z as _,a as w,c as H,u as Q,H as Y}from"./app-DT32C7nY.js";import{C as G,M as Z,S as ee,T as ae,A as se}from"./Table-CL22LIrt.js";import{F as re}from"./FormCurrencyInput-Y-IASF2j.js";import{u as te,F as le,a as M,o as ie,c as oe,b as F,d as V}from"./index.esm-Ci-6NNXr.js";import{F as ne,S as de}from"./FormSelect-dtlN2kn6.js";import{c as ce}from"./createLucideIcon-CMnZVN2_.js";import{X as T}from"./x-CHumAv0e.js";import{B as $}from"./Button-DkoYT9R8.js";import{B as O}from"./Badge-ayPLFCxx.js";import{C as A,a as q,c as ue,b as me}from"./Card-DvLVLLze.js";import{P as pe}from"./Pagination-DsMwMylt.js";import{A as he}from"./AdminLayout-qkJBv-y2.js";import{P as be}from"./plus-K_uxNSFF.js";import"./trash-2-BHSVLgJt.js";import"./chevron-right-bjn_y0tR.js";import"./users-D15wB9T6.js";import"./user-DeY8Ogeh.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],xe=ce("grip-vertical",ge);function ke({label:p,name:D,accept:s="image/*",multiple:f=!1,onChange:n,disabled:u=!1,helperText:j,maxSize:k=2}){const[b,c]=l.useState([]),[x,o]=l.useState(null),S=i=>{const m=Array.from(i.target.files),r=k*1024*1024,d=[],t=[];if(m.forEach(g=>{g.size>r?t.push({name:g.name,size:(g.size/(1024*1024)).toFixed(2)}):d.push(g)}),t.length>0){const g=t.length===1?`File "${t[0].name}" terlalu besar (${t[0].size}MB). Maksimal ${k}MB.`:`${t.length} file melebihi batas ${k}MB dan tidak akan diupload.`;_.error(g,{duration:4e3})}if(d.length===0){i.target.value="";return}const h=d.map((g,z)=>({file:g,url:URL.createObjectURL(g),name:g.name,size:(g.size/(1024*1024)).toFixed(2),position:b.length+z+1})),P=[...b,...h];c(P),n&&n(P.map(g=>g.file)),i.target.value=""},y=i=>{const r=b.filter((d,t)=>t!==i).map((d,t)=>({...d,position:t+1}));c(r),n&&n(r.map(d=>d.file))},C=i=>{o(i)},v=i=>{i.preventDefault()},E=(i,m)=>{if(i.preventDefault(),x===null||x===m)return;const r=[...b],d=r[x];r.splice(x,1),r.splice(m,0,d);const t=r.map((h,P)=>({...h,position:P+1}));c(t),o(null),n&&n(t.map(h=>h.file))};return e.jsxs("div",{className:"form-control w-full",children:[p&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:p})}),e.jsx("input",{type:"file",name:D,accept:s,multiple:f,onChange:S,disabled:u,className:"file-input file-input-bordered w-full"}),j&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-base-content/60",children:j})}),b.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-sm font-medium mb-2 text-base-content/80",children:["Preview (",b.length," gambar) - Drag untuk mengatur urutan"]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:b.map((i,m)=>e.jsxs("div",{draggable:!u,onDragStart:()=>C(m),onDragOver:v,onDrop:r=>E(r,m),className:`relative group cursor-move ${x===m?"opacity-50":""}`,children:[e.jsx("div",{className:"absolute top-2 left-2 z-10 bg-base-100/80 rounded p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(xe,{size:16,className:"text-base-content/60"})}),e.jsx("img",{src:i.url,alt:i.name,className:"w-full h-32 object-cover rounded-lg border-2 border-base-300"}),e.jsx("button",{type:"button",onClick:()=>y(m),className:"absolute top-2 right-2 btn btn-circle btn-sm btn-error opacity-0 group-hover:opacity-100 transition-opacity z-10",disabled:u,children:e.jsx(T,{size:16})}),e.jsxs("div",{className:"absolute bottom-2 left-2 badge badge-primary badge-lg font-bold",children:["Posisi ",i.position]}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"text-xs truncate text-base-content/60",children:i.name}),e.jsxs("p",{className:"text-xs text-base-content/50",children:[i.size," MB"]})]})]},m))})]})]})}function fe({images:p=[],varianProdukId:D,onDelete:s}){const[f,n]=l.useState(!1),[u,j]=l.useState(null),[k,b]=l.useState(p);l.useEffect(()=>{b(p)},[p]);const c=o=>{j(o),n(!0)},x=()=>{u&&w.delete(`/admin/gambar-produk/${u.id}`,{preserveScroll:!0,onSuccess:()=>{b(o=>o.filter(S=>S.id!==u.id)),n(!1),j(null),s&&s(u.id)},onError:o=>{console.error("Delete error:",o),n(!1),j(null)}})};return!k||k.length===0?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text font-medium",children:["Gambar Existing (",k.length,")"]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:k.map(o=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:`/storage/${o.gambar_produk}`,alt:`Posisi ${o.posisi}`,className:"w-full h-32 object-cover rounded-lg border-2 border-base-300",onError:S=>{S.target.src="https://via.placeholder.com/150?text=No+Image"}}),e.jsx("button",{type:"button",onClick:()=>c(o),className:"absolute top-2 right-2 btn btn-circle btn-sm btn-error opacity-0 group-hover:opacity-100 transition-opacity z-10",children:e.jsx(T,{size:16})}),e.jsxs("div",{className:"absolute bottom-2 left-2 badge badge-secondary badge-lg font-bold",children:["Posisi ",o.posisi]}),e.jsx("div",{className:"mt-1",children:e.jsx("p",{className:"text-xs text-base-content/60 truncate",children:o.gambar_produk.split("/").pop()})})]},o.id))}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-base-content/60",children:"Klik X untuk menghapus gambar. Upload gambar baru akan ditambahkan setelah gambar existing."})})]}),e.jsx(G,{isOpen:f,onClose:()=>{n(!1),j(null)},onConfirm:x,title:"Hapus Gambar",message:`Apakah Anda yakin ingin menghapus gambar posisi ${u?.posisi}?`})]})}const je=oe({produk_id:F().required("Produk wajib dipilih"),nama_atribut:F().required("Nama atribut wajib diisi"),nama_varian:F().required("Nama varian wajib diisi"),harga:V().required("Harga wajib diisi").min(0,"Harga tidak boleh negatif"),stok:V().required("Stok wajib diisi").min(0,"Stok tidak boleh negatif"),deskripsi:F().nullable()});function L({isOpen:p,onClose:D,varianProduk:s=null,onSuccess:f}){const n=!!s,[u,j]=l.useState([]),[k,b]=l.useState(!1),[c,x]=l.useState(!1),[o,S]=l.useState([]),y=te({resolver:ie(je),defaultValues:{produk_id:"",nama_atribut:"",nama_varian:"",harga:0,stok:0,deskripsi:""}}),{handleSubmit:C,reset:v}=y;l.useEffect(()=>{p&&(async()=>{b(!0);try{const d=await H.get(route("admin.produk.list"));j(d.data)}catch(d){console.error("Error fetching produk:",d),_.error("Gagal memuat daftar produk")}finally{b(!1)}})()},[p]),l.useEffect(()=>{v(s?{produk_id:s.produk_id||"",nama_atribut:s.nama_atribut||"",nama_varian:s.nama_varian||"",harga:s.harga||0,stok:s.stok||0,deskripsi:s.deskripsi||""}:{produk_id:"",nama_atribut:"",nama_varian:"",harga:0,stok:0,deskripsi:""})},[s,v]);const E=r=>{x(!0);const d=n?`/admin/varian-produk/${s.id}`:"/admin/varian-produk",t=new FormData;t.append("produk_id",r.produk_id),t.append("nama_atribut",r.nama_atribut),t.append("nama_varian",r.nama_varian),t.append("harga",r.harga),t.append("stok",r.stok),r.deskripsi&&t.append("deskripsi",r.deskripsi),o.forEach(h=>{t.append("gambar[]",h)}),n&&t.append("_method","PUT"),w.post(d,t,{forceFormData:!0,onSuccess:()=>{i(),f&&f()},onError:h=>{console.error("Submit error:",h),h.message?_.error(h.message):Object.values(h).length>0?_.error(Object.values(h)[0]):_.error(`Terjadi kesalahan saat ${n?"mengubah":"menambah"} varian produk`)},onFinish:()=>{x(!1)}})},i=()=>{v(),S([]),D()},m=u.map(r=>({value:r.id,label:`${r.nama_produk} (${r.kategori?.nama_kategori||"-"})`}));return e.jsx(Z,{id:"modal-varian-produk",isOpen:p,onClose:i,size:"3xl",className:"max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:n?"Edit Varian Produk":"Tambah Varian Produk"}),e.jsx(le,{...y,children:e.jsxs("form",{onSubmit:C(E),className:"space-y-4",children:[e.jsx(ne,{name:"produk_id",label:"Produk",options:m,placeholder:"Pilih Produk",isDisabled:c||k,isSearchable:!0,isClearable:!1,required:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(M,{name:"nama_atribut",label:"Nama Atribut",placeholder:"Contoh: Ukuran, Warna, Rasa",disabled:c,required:!0}),e.jsx(M,{name:"nama_varian",label:"Nama Varian",placeholder:"Contoh: Kecil, Merah, Coklat",disabled:c,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(re,{name:"harga",label:"Harga",placeholder:"0",disabled:c,required:!0}),e.jsx(M,{name:"stok",label:"Stok",type:"number",placeholder:"0",min:"0",disabled:c,required:!0})]}),e.jsxs("div",{className:"form-control w-full",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Deskripsi (Opsional)"})}),e.jsx("textarea",{className:"textarea textarea-bordered w-full h-24 resize-none",placeholder:"Tambahkan deskripsi detail varian produk...",disabled:c,...y.register("deskripsi")}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-base-content/60",children:"Contoh: Ukuran diameter 20cm, cocok untuk 8-10 orang"})})]}),n&&s?.gambar_produks&&s.gambar_produks.length>0&&e.jsx(fe,{images:s.gambar_produks,varianProdukId:s.id}),e.jsx(ke,{label:"Gambar Produk (Opsional)",name:"gambar",accept:"image/*",multiple:!0,maxSize:2,onChange:S,disabled:c,helperText:"Format: JPEG, PNG, JPG, WEBP. Maksimal 2MB per file. File yang melebihi batas akan ditolak."}),e.jsxs("div",{className:"modal-action",children:[e.jsx($,{variant:"outline",type:"button",onClick:i,disabled:c,children:"Batal"}),e.jsx($,{variant:"primary",type:"submit",disabled:c||k,children:c?"Menyimpan...":n?"Simpan Perubahan":"Simpan"})]})]})})]})})}function Ve({varianProduk:p,filters:D}){const{props:s}=Q(),[f,n]=l.useState(D.search||""),[u,j]=l.useState(D.produk_id||""),[k,b]=l.useState([]),[c,x]=l.useState(!1),[o,S]=l.useState(null),[y,C]=l.useState(D.sort||"nama_varian"),[v,E]=l.useState(D.direction||"asc"),[i,m]=l.useState(!1),[r,d]=l.useState(!1),[t,h]=l.useState(null);l.useEffect(()=>{(async()=>{try{const N=await H.get(route("admin.produk.list"));b(N.data)}catch(N){console.error("Error fetching produk:",N)}})()},[]),l.useEffect(()=>{s.success&&_.success(s.success),s.error&&_.error(s.error)},[s.success,s.error]);const P=a=>{a.preventDefault(),w.get(route("admin.varian-produk.index"),{search:f,produk_id:u,sort:y,direction:v},{preserveState:!0,preserveScroll:!0})},g=a=>{const N=a?a.value:"";j(N),w.get(route("admin.varian-produk.index"),{search:f,produk_id:N,sort:y,direction:v},{preserveState:!0,preserveScroll:!0})},z=()=>{j(""),w.get(route("admin.varian-produk.index"),{search:f,sort:y,direction:v},{preserveState:!0,preserveScroll:!0})},R=a=>{const N=y===a&&v==="asc"?"desc":"asc";C(a),E(N),w.get(route("admin.varian-produk.index"),{search:f,produk_id:u,sort:a,direction:N},{preserveState:!0,preserveScroll:!0})},U=a=>{S(a),x(!0)},J=()=>{o&&w.delete(`/admin/varian-produk/${o.id}`,{preserveScroll:!0,onSuccess:()=>{x(!1),S(null)},onError:a=>{console.error("Delete error:",a),a.message?_.error(a.message):Object.values(a).length>0?_.error(Object.values(a)[0]):_.error("Terjadi kesalahan saat menghapus varian produk")}})},K=a=>{h(a),d(!0)},B=()=>{d(!1),h(null)},W=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),I=[{value:"",label:"Semua Produk"},...k.map(a=>({value:a.id,label:`${a.nama_produk} (${a.kategori?.nama_kategori||"-"})`}))],X=u?I.find(a=>a.value===u):I[0];return e.jsxs(he,{auth:s.auth,header:"Data Varian Produk",children:[e.jsx(Y,{title:"Data Varian Produk"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(A,{children:e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row",children:[e.jsx(ee,{value:f,onChange:n,onSubmit:P,placeholder:"Cari varian produk...",className:"flex-1"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-full md:w-80",children:e.jsx(de,{options:I,value:X,onChange:g,placeholder:"Filter Produk",isSearchable:!0,isClearable:!1})}),u&&e.jsxs($,{variant:"outline",onClick:z,className:"gap-2",children:[e.jsx(T,{size:16}),"Clear"]})]}),e.jsxs($,{variant:"primary",className:"gap-2",onClick:()=>m(!0),children:[e.jsx(be,{size:18}),"Tambah Varian"]})]})})}),e.jsxs(A,{children:[e.jsx(ue,{children:e.jsxs(me,{children:["Daftar Varian Produk (",p.total,")"]})}),e.jsx(q,{className:"p-0",children:e.jsx(ae,{headers:[{label:"No",key:"no",sortable:!1},{label:"Produk",key:"produk",sortable:!1},{label:"Atribut",key:"nama_atribut",sortable:!0},{label:"Varian",key:"nama_varian",sortable:!0},{label:"Harga",key:"harga",sortable:!0},{label:"Stok",key:"stok",sortable:!0},{label:"Aksi",key:"aksi",sortable:!1}],data:p.data,renderRow:(a,N)=>e.jsxs("tr",{children:[e.jsx("td",{children:(p.current_page-1)*p.per_page+N+1}),e.jsx("td",{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:a.produk?.nama_produk||"-"}),e.jsx("span",{className:"text-xs text-base-content/60",children:a.produk?.kategori?.nama_kategori||"-"})]})}),e.jsx("td",{children:e.jsx(O,{variant:"secondary",children:a.nama_atribut})}),e.jsx("td",{children:a.nama_varian}),e.jsx("td",{className:"font-medium",children:W(a.harga)}),e.jsx("td",{children:e.jsxs(O,{variant:a.stok>0?"success":"error",children:[a.stok," unit"]})}),e.jsx("td",{children:e.jsx(se,{onEdit:()=>K(a),onDelete:()=>U(a)})})]},a.id),emptyMessage:"Tidak ada data varian produk",emptyColSpan:7,sortConfig:{key:y,direction:v},onSort:R})})]}),e.jsx(pe,{links:p.links})]}),e.jsx(L,{isOpen:i,onClose:()=>m(!1),onSuccess:()=>{m(!1),w.reload()}}),e.jsx(L,{isOpen:r,onClose:B,varianProduk:t,onSuccess:()=>{B(),w.reload()}}),e.jsx(G,{isOpen:c,onClose:()=>x(!1),onConfirm:J,title:"Hapus Varian Produk",message:`Apakah Anda yakin ingin menghapus varian "${o?.nama_varian}" dari produk "${o?.produk?.nama_produk}"?`})]})}export{Ve as default};
